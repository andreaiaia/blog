---
import styles from './TextWithTranslation.module.scss';

interface Props {
  leftLang?: string;
  rightLang?: string;
  leftLabel?: string;
  rightLabel?: string;
  fixedHeight?: boolean; // false = altezza dinamica, true = altezza fissa con scroll
}

const {
  leftLang = 'left',
  rightLang = 'right',
  leftLabel = 'Original',
  rightLabel = 'Translation',
  fixedHeight = false,
}: Props = Astro.props;
---

<div
  class={`${styles.wrapper} ${fixedHeight ? styles.fixedHeight : styles.dynamicHeight}`}
  data-state='left'
>
  <button
    class={`${styles.chevronBtn} ${styles.chevronLeft}`}
    aria-label={`Show ${leftLabel}`}
    aria-expanded='false'
  >
    <svg
      width='24'
      height='24'
      viewBox='0 0 24 24'
      fill='none'
      stroke='currentColor'
      stroke-width='2'
    >
      <polyline points='9 18 15 12 9 6'></polyline>
    </svg>
  </button>

  <div class={styles.container}>
    <div
      class={`${styles.column} ${styles.columnLeft}`}
      lang={leftLang}
      data-label={leftLabel}
    >
      <div class={styles.columnContent}>
        <slot name='left' />
      </div>
    </div>

    <div
      class={`${styles.column} ${styles.columnRight}`}
      lang={rightLang}
      data-label={rightLabel}
    >
      <div class={styles.columnContent}>
        <slot name='right' />
      </div>
    </div>
  </div>

  <button
    class={`${styles.chevronBtn} ${styles.chevronRight}`}
    aria-label={`Show ${rightLabel}`}
    aria-expanded='false'
  >
    <svg
      width='24'
      height='24'
      viewBox='0 0 24 24'
      fill='none'
      stroke='currentColor'
      stroke-width='2'
    >
      <polyline points='15 18 9 12 15 6'></polyline>
    </svg>
  </button>
</div>

<script>
  type DualTextState = 'left' | 'right';

  function initDualText(): void {
    const wrappers = document.querySelectorAll<HTMLElement>('[data-state]');

    wrappers.forEach((wrapper) => {
      const leftBtn = wrapper.querySelector<HTMLButtonElement>(
        'button:first-of-type'
      );
      const rightBtn = wrapper.querySelector<HTMLButtonElement>(
        'button:last-of-type'
      );
      let currentState: DualTextState = 'left';

      leftBtn?.addEventListener('click', () => {
        currentState = 'left';
        wrapper.setAttribute('data-state', currentState);
        leftBtn.setAttribute('aria-expanded', 'true');
        rightBtn?.setAttribute('aria-expanded', 'false');
      });

      rightBtn?.addEventListener('click', () => {
        currentState = 'right';
        wrapper.setAttribute('data-state', currentState);
        rightBtn.setAttribute('aria-expanded', 'true');
        leftBtn?.setAttribute('aria-expanded', 'false');
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDualText);
  } else {
    initDualText();
  }

  document.addEventListener('astro:page-load', initDualText);
</script>
